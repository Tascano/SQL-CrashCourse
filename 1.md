
# Section 1 ‚Äî SQL & Database Foundations
This section lays the groundwork by introducing core database terminology and the five categories of SQL commands.

1.1 The Database Landscape

| Concept | Explanation | Analogy |
|----------|--------------|----------|
| Database | An organized collection of related data, usually stored electronically on a computer system. | A filing cabinet that holds many folders. |
| Table (Relation) | A collection of data organized into rows (records) and columns (fields). | A single folder inside the cabinet, holding similar types of documents. |
| Schema | The structure/design of the database‚Äîit defines how the data is organized, including tables, columns, data types, and relationships. | The index or blueprint that shows all the folders, what papers they hold, and how they relate. |

1.2 Keys and Constraints
Keys and Constraints are rules enforced by the database to ensure Data Integrity (accuracy and consistency).

| Concept | Explanation | Example (from users table) |
|----------|--------------|-----------------------------|
| Primary Key (PK) | A column (or set of columns) that uniquely identifies each row in a table. Must be NOT NULL and UNIQUE. | user_id |
| Foreign Key (FK) | A column (or set of columns) in one table that refers to the Primary Key of another table. It establishes a link between tables. | user_id in the engagement table references user_id in the users table. |
| Composite Key | A Primary Key composed of two or more columns that, when combined, uniquely identify a row. | In the engagement table, a combination of (user_id, content_id, event_time) might form a composite key to track specific interactions. |
| NOT NULL | Ensures a column cannot contain a NULL value. | name in the users table should be NOT NULL. |
| UNIQUE | Ensures all values in a column are different. (A table can have multiple UNIQUE constraints, but only one PK). | email (if it existed) in the users table. |

üìù Exercise 1.2
1.2.1 Identify the Primary Key (PK) for the subscriptions table:

* user_id
* plan
* A composite key of (user_id, start_date)

1.2.2. What key is needed in the engagement table to link it to the content table?
 - Solution 1: The PK is a composite of (user_id, start_date) because a single user can have multiple subscriptions over time.
 - Solution 2: A Foreign Key to content_id.

1.3 DDL (Data Definition Language)

DDL commands are used to define or modify the structure of the database objects.

| Command | Purpose | Example |
|----------|----------|----------|
| CREATE DATABASE | Creates a new database. | CREATE DATABASE UserEngagementDB; |
| CREATE TABLE | Creates a new table with its specified columns, data types, and constraints. | CREATE TABLE users (user_id INT PRIMARY KEY, name VARCHAR(100), signup_date DATE); |
| ALTER TABLE | Changes the structure of an existing table (e.g., adding/dropping columns, modifying constraints). | ALTER TABLE users ADD COLUMN email VARCHAR(100) UNIQUE; |
| DROP TABLE | Completely removes a table and all its data from the database. | DROP TABLE users; |

üìù Exercise 1.3
Write the DDL command to add a new column last_login_date of type DATE to the existing users table.

```
ALTER TABLE users
ADD COLUMN last_login_date DATE;
```

1.4 DML (Data Manipulation Language)
DML commands are used to manage data within schema objects.

| Command | Purpose | Example |
|----------|----------|----------|
| INSERT | Adds new rows of data into a table. | INSERT INTO users (user_id, name, country) VALUES (1, 'Alice', 'USA'); |
| UPDATE | Modifies existing data in one or more rows. Requires a WHERE clause to avoid updating all rows. | UPDATE users SET country = 'CAN' WHERE user_id = 1; |
| DELETE | Removes one or more rows from a table. Requires a WHERE clause to avoid deleting all rows. | DELETE FROM users WHERE user_id = 1; |

TRUNCATE vs DELETE

| Feature | DELETE | TRUNCATE |
|----------|---------|-----------|
| Row-by-Row | Yes (Can remove specific rows). | No (Removes all rows). |
| Speed | Slower (writes to transaction log). | Faster (De-allocates data pages). |
| Transaction | Yes (Can be ROLLED BACK). | No (Usually CANNOT be rolled back). |
| Identity Counter | Resets only if done manually. | Resets identity/autoincrement counters. |

üìù Exercise 1.4
Write the DML to change the plan for user_id = 5 in the subscriptions table to 'Premium'.

Which command is faster for clearing all data from the engagement table for a daily cleanup job?

SQL
```
-- Exercise 1.4 Solution 1
UPDATE subscriptions
SET plan = 'Premium'
WHERE user_id = 5;

-- Exercise 1.4 Solution 2
-- TRUNCATE is generally faster as it de-allocates the data space.
TRUNCATE TABLE engagement;
```

1.5 DQL (Data Query Language)
DQL is technically a subset of DML, but it is often separated as the most common operation: retrieving data.

| Command/Clause | Purpose | Example |
|----------------|----------|----------|
| SELECT | Specifies the columns to be retrieved. | SELECT name, country FROM users; |
| WHERE | Filters the rows based on a condition. | ... WHERE country = 'USA'; |
| ORDER BY | Sorts the result set. | ... ORDER BY signup_date DESC; |
| GROUP BY | Groups rows that have the same values in specified columns. Used with aggregate functions. | SELECT country, COUNT(*) FROM users GROUP BY country; |
| HAVING | Filters the results of a GROUP BY clause. (Filters after aggregation). | ... HAVING COUNT(*) > 10; |
| DISTINCT | Returns only unique (non-duplicate) values in the result set. | SELECT DISTINCT category FROM content; |
| LIMIT | Restricts the number of rows returned. (Often called TOP in some dialects). | SELECT * FROM users LIMIT 10; |
| BETWEEN | Filters values within a specified range (inclusive). | ... WHERE duration_in_seconds BETWEEN 60 AND 300; |
| LIKE | Searches for a specified pattern in a column. Uses wildcards (% for zero or more characters, _ for exactly one). | ... WHERE title LIKE 'The%'; |

üìù Exercise 1.5
Write a DQL query to find the unique countries from the users table where the user name starts with the letter 'A', and order the result alphabetically.

```
SELECT DISTINCT country
FROM users
WHERE name LIKE 'A%'
ORDER BY country ASC;
```

1.6 DCL (Data Control Language)
DCL manages permissions and access rights to the database and its objects.

| Command | Purpose | Example |
|----------|----------|----------|
| GRANT | Gives a user or role permission to perform a specific task (e.g., SELECT, INSERT). | GRANT SELECT ON users TO 'analyst_role'; |
| REVOKE | Removes a user's or role's permissions. | REVOKE INSERT ON content FROM 'analyst_role'; |

1.7 TCL (Transaction Control Language) & ACID
TCL commands manage transactions, ensuring data consistency during multi-step operations.

A Transaction is a single logical unit of work, consisting of one or more SQL statements.

| Command | Purpose | Explanation |
|----------|----------|-------------|
| COMMIT | Makes all changes from the current transaction permanent. | "OK, save all these changes to the database forever." |
| ROLLBACK | Undoes all changes from the current transaction, returning the database to the state before the transaction began. | "Wait, that was a mistake, undo everything and go back to how it was." |
| SAVEPOINT | Creates a point within a transaction to which you can later roll back. | "I've completed step 1 and step 2. If step 3 fails, I only need to roll back to this point, not the very start." |

The ACID Properties
The core guarantee of a relational database, ensuring that transactions are processed reliably.

| Property | Meaning | Analogy: Transferring Money |
|-----------|----------|-----------------------------|
| Atomicity | All or nothing. A transaction must either fully succeed or fully fail. | The money must successfully leave the source account AND arrive at the destination account. No half-transfers. |
| Consistency | The transaction only brings the database from one valid state to another, maintaining all data integrity rules (constraints). | Constraints like "total money in the bank must stay positive" are upheld. The transfer itself doesn't break any rules. |
| Isolation | Multiple transactions occurring concurrently will not interfere with each other. The result is the same as if they ran sequentially. | If two people check the account balance during the transfer, they either see the state before or the state after‚Äînever an intermediate, incorrect value. |
| Durability | Once a transaction is committed, the changes are permanent and will survive a system failure (e.g., power loss). | Once the COMMIT is executed, the bank guarantees the money is transferred, even if the server immediately crashes. |

üìù Exercise 1.7
A user mistakenly deletes the entire content table. What TCL command must the database architect execute immediately before the system executes the COMMIT for the DELETE to return the table to its previous state?

```
-- Assuming the DELETE statement was executed within a transaction block
ROLLBACK;
```
